////
Copyright 2024 Matt Borland
Distributed under the Boost Software License, Version 1.0.
https://www.boost.org/LICENSE_1_0.txt
////

[#Benchmarks]
= Benchmarks
:idprefix: benchmarks_

This section describes a range of performance benchmarks that have been run comparing this library with the standard library, and how to run your own benchmarks if required.

The values in the ratio column are how many times longer running a specific operation takes in comparison to the same operation with a `double`.

IMPORTANT: On nearly all platforms there is hardware support for binary floating point math, so we are comparing hardware to software runtimes; *Decimal will be slower*

== How to run the Benchmarks
[#run_benchmarks_]

To run the benchmarks yourself, navigate to the test folder and define `BOOST_DECIMAL_RUN_BENCHMARKS` when running the tests.
An example on Linux with b2: `../../../b2 cxxstd=20 toolset=gcc-13 define=BOOST_DECIMAL_RUN_BENCHMARKS benchmarks -a release` .

== Comparisons

The benchmark for comparisons generates a random vector containing 20,000,000 elements and does operations `>`, `>=`, `<`, `\<=`, `==`, and `!=` between `vec[i] and vec[i + 1]`.
This is repeated 5 times to generate stable results.

=== x64 Linux Results

Run using an Intel i9-11900k chipset running RHEL 9.4 and GCC 11.4.1-3

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 35,581
| 0.604
| `double`
| 58,848
| 1.000
| `decimal32`
| 2,410,084
| 40.954
| `decimal64`
| 4,233,175
| 71.934
| `decimal128`
| 6,337,447
| 107.692
| `decimal32_fast`
| 628,241
| 10.676
| `decimal64_fast`
| 724,474
| 12.311
| `decimal128_fast`
| 517,930
| 8.801
| GCC `_Decimal32`
| 893,375
| 15.181
| GCC `_Decimal64`
| 496,127
| 8.431
| GCC `_Decimal128`
| 1,143,636
| 19.434
|===

=== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 15.0 and homebrew Clang 18.1.8

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 146,976
| 2.319
| `double`
| 63,382
| 1.000
| `decimal32`
| 1,797,597
| 28.361
| `decimal64`
| 2,799,376
| 44.167
| `decimal128`
| 6,478,939
| 102.220
| `decimal32_fast`
| 1,070,232
| 16.885
| `decimal64_fast`
| 1,111,273
| 17.533
| `decimal128_fast`
| 1,118,976
| 17.654
|===

== Basic Operations

The benchmark for these operations generates a random vector containing 20,000,000 elements and does operations `+`, `-`, `*`, `/` between `vec[i] and vec[i + 1]`.
This is repeated 5 times to generate stable results.

=== x64 Linux Results

Run using an Intel i9-11900k chipset running RHEL 9.4 and GCC 11.4.1-3

==== Addition

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 54,566
| 1.077
| `double`
| 50,640
| 1.000
| `decimal32`
| 3,639,957
| 71.879
| `decimal64`
| 4,172,318
| 82.392
| `decimal128`
| 10,936,595
| 215.968
| `decimal32_fast`
| 1,148,249
| 22.675
| `decimal64_fast`
| 1,149,203
| 22.694
| `decimal128_fast`
| 7,424,598
| 146.615
| GCC `_Decimal32`
| 2,997,658
| 50.939
| GCC `_Decimal64`
| 2,129,898
| 36.193
| GCC `_Decimal128`
| 3,056,979
| 51.947
|===

==== Subtraction

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 48,654
| 0.912
| `double`
| 53,348
| 1.000
| `decimal32`
| 2,850,709
| 53.436
| `decimal64`
| 3,493,936
| 65.493
| `decimal128`
| 10,492,728
| 196.685
| `decimal32_fast`
| 1,012,199
| 18.974
| `decimal64_fast`
| 1,055,476
| 19.785
| `decimal128_fast`
| 2,114,185
| 39.630
| GCC `_Decimal32`
| 2,006,964
| 37.620
| GCC `_Decimal64`
| 1,324,796
| 24.833
| GCC `_Decimal128`
| 2,783,553
| 52.177
|===

==== Multiplication

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 53,405
| 1.101
| `double`
| 48,497
| 1.000
| `decimal32`
| 2,708,779
| 55.855
| `decimal64`
| 2,761,465
| 56.941
| `decimal128`
| 8,509,678
| 175.468
| `decimal32_fast`
| 451,679
| 9.313
| `decimal64_fast`
| 777,927
| 16.041
| `decimal128_fast`
| 13,970,509
| 288.070
| GCC `_Decimal32`
| 2,507,998
| 51.714
| GCC `_Decimal64`
| 2,414,864
| 49.794
| GCC `_Decimal128`
| 6,248,956
| 128.852
|===

==== Division

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 58,955
| 0.755
| `double`
| 78,046
| 1.000
| `decimal32`
| 2,907,134
| 37.249
| `decimal64`
| 3,464,841
| 44.394
| `decimal128`
| 18,202,742
| 233.231
| `decimal32_fast`
| 1,092,346
| 13.996
| `decimal64_fast`
| 1,207,648
| 15.474
| `decimal128_fast`
| 1,208,184
| 15.480
| GCC `_Decimal32`
| 5,002,197
| 64.093
| GCC `_Decimal64`
| 2,961,731
| 37.900
| GCC `_Decimal128`
| 10,095,995
| 129.360
|===

=== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

==== Addition

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 16,685
| 0.955
| `double`
| 17,476
| 1.000
| `decimal32`
| 2,528,095
| 144.661
| `decimal64`
| 2,713,507
| 155.270
| `decimal128`
| 11,969,714
| 684.923
| `decimal32_fast`
| 1,423,277
| 81.442
| `decimal64_fast`
| 1,280,409
| 73.267
| `decimal128_fast`
| 6,047,499
| 346.046
|===

==== Subtraction

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 16,302
| 1.045
| `double`
| 17,033
| 1.000
| `decimal32`
| 2,010,525
| 118.037
| `decimal64`
| 2,237,729
| 131.376
| `decimal128`
| 6,907,396
| 405.530
| `decimal32_fast`
| 1,378,448
| 80.928
| `decimal64_fast`
| 1,276,731
| 74.956
| `decimal128_fast`
| 2,970,586
| 174.401
|===

==== Multiplication

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 16,499
| 0.926
| `double`
| 17,821
| 1.000
| `decimal32`
| 1,951,504
| 109.506
| `decimal64`
| 2,480,528
| 139.191
| `decimal128`
| 14,360,630
| 805.826
| `decimal32_fast`
| 630,355
| 35.371
| `decimal64_fast`
| 987,703
| 55.424
| `decimal128_fast`
| 12,573,178
| 705.526
|===

==== Division

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 20,267
| 0.841
| `double`
| 24,111
| 1.000
| `decimal32`
| 1,757,506
| 72.892
| `decimal64`
| 3,496,913
| 145.033
| `decimal128`
| 20,017,989
| 830.243
| `decimal32_fast`
| 846,727
| 35.118
| `decimal64_fast`
| 2,484,985
| 103.064
| `decimal128_fast`
| 2,490,175
| 103.280
|===

////
These are not available for the built-ins so not deleting but also not incorporating

== Selected Special Functions

The benchmark for these operations generates a random vector containing 2,000,000 elements and does operations `+`, `-`, `*`, `/` between `vec[i] and vec[i + 1]`.
This is repeated 5 times to generate stable results.

=== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

==== SQRT

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 2021
| 0.626
| `double`
| 3229
| 1.000
| `decimal32`
| 4,826,066
| 1494.601
| `decimal64`
| 7,780,637
| 2409.612
| `decimal128`
| 100,269,145
| 31052.693
|===

== `<charconv>`

For all the following the results compare against https://github.com/boostorg/charconv[boost.charconv] for 10'000'000 conversions.

=== `from_chars` general

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 235,816
| 0.953
| `double`
| 247,307
| 1.000
| `decimal32`
| 366,682
| 1.483
| `decimal64`
| 485,965
| 1.965
// Decimal128 was two orders of magnitude faster. I expect an issue
//| `decimal128`
//| 275,779,340
//| 73267.60
|===

NOTE: `decimal128` is currently absent due to results showing it is 2 orders of magnitude faster than the others.
This should not be the case so will be investigated.

=== `from_chars` scientific

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 241,893
| 0.975
| `double`
| 247,975
| 1.000
| `decimal32`
| 358,189
| 1.444
| `decimal64`
| 477,574
| 1.926
// Decimal128 was two orders of magnitude faster. I expect an issue
//| `decimal128`
//| 275,779,340
//| 73267.60
|===

NOTE: `decimal128` is currently absent due to results showing it is 2 orders of magnitude faster than the others.
This should not be the case so will be investigated.

=== `to_chars` general shortest representation

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 316,300
| 1.040
| `double`
| 304,272
| 1.000
| `decimal32`
| 406,053
| 1.335
| `decimal64`
| 678,451
| 2.230
| `decimal128`
| 6,309,346
| 20.736
|===

=== `to_chars` general 6-digits of precision

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 323,867
| 0.967
| `double`
| 334,989
| 1.000
| `decimal32`
| 409,608
| 1.223
| `decimal64`
| 702,339
| 2.097
| `decimal128`
| 6,305,521
| 18.823
|===

=== `to_chars` scientific shortest representation

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 286,330
| 1.011
| `double`
| 283,287
| 1.000
| `decimal32`
| 290,117
| 1.024
| `decimal64`
| 499,637
| 1.764
| `decimal128`
| 3,096,910
| 10.932
|===

=== `to_chars` scientific 6-digits of precision

==== M1 macOS Results

Run using a Macbook pro with M1 pro chipset running macOS Sonoma 14.4.1 and homebrew Clang 18.1.4

|===
| Type | Runtime (us) | Ratio to `double`
| `float`
| 258,710
| 0.809
| `double`
| 319,676
| 1.000
| `decimal32`
| 292,250
| 0.914
| `decimal64`
| 516,399
| 1.615
| `decimal128`
| 3,108,380
| 9.724
|===

////
